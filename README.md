# AI SQC Sampler

統計的品質管理（SQC）の AQL / LTPD 設計をベースに、Microsoft Access データベースの実績値を活用してサンプリング検査数を算出するデスクトップアプリケーションです。検査区分（強化・標準・緩和）の設定機能と、検査水準管理機能を備えた包括的な品質管理ツールです。

## 📦 配布パッケージ構成

配布ディレクトリには主に以下のファイルが含まれます。

- AI_SQC_Sampler.exe – アプリケーション本体（ワンファイル実行形式）
- config/ – 初期設定値を格納する JSON ファイル（任意）
- docs/ – 操作マニュアルや参考資料（任意）
- security.log – 実行時に生成されるセキュリティログ（必要に応じて出力）

> 開発用ソースコードが必要な場合は Git リポジトリを取得してくださいが、エンドユーザーは AI_SQC_Sampler.exe を実行するだけで利用できます。

## 🚀 初回起動と基本操作

1. AI_SQC_Sampler.exe を任意のフォルダーに配置してダブルクリックします。
2. 初回起動時は「ファイル > 設定…」から Access データベース（.accdb / .mdb）のパスを指定してください。
3. 検査区分（強化・標準・緩和）を選択し、品番・ロットサイズを入力します。
4. 🚀 計算実行 を押すと詳細結果が表示されます。
5. 結果は必要に応じて 📄 結果をテキストファイルに保存 で出力できます。

### 🔧 検査区分の選択

アプリケーションは3つの検査区分を提供します：

| 検査区分 | AQL | LTPD | α | β | c値 | 用途 |
|----------|-----|------|---|---|-----|------|
| **強化検査** | 0.10% | 0.50% | 3.0% | 5.0% | 0 | 初期流動・不具合再発時 |
| **標準検査** | 0.25% | 1.0% | 5.0% | 10.0% | 0 | 通常ロット（デフォルト） |
| **緩和検査** | 0.40% | 1.50% | 10.0% | 15.0% | 0 | 安定生産・顧客信頼製品 |

- **アプリ起動時**: 毎回「標準検査」で起動します
- **検査区分の変更**: メイン画面の検査区分セレクターで選択可能
- **設定のカスタマイズ**: アプリケーション設定画面で各検査区分のデフォルト値を変更可能

### 主な画面と機能

| セクション | 内容 |
|------------|------|
| 検査区分選択 | 強化・標準・緩和の検査区分を選択（デフォルト：標準検査） |
| 入力エリア | 品番、ロットサイズ、対象期間を入力（統計パラメータは検査区分で自動設定） |
| 結果カード | 抜取検査数・過去不具合の注意喚起・検査水準などをカード形式で表示 |
| レビュー表 | 基本情報・統計パラメータ・データベース実績活用の調整内容を1つの表に集約 |
| 追加機能 | 📊 OCカーブ表示、📋 検査水準管理、品番リスト、代替案提案などを提供 |

### ⚙️ アプリケーション設定

「ファイル > 設定…」から以下の設定が可能です：

#### データベース設定
- **Access データベースパス**: 不良情報記録データベース（.accdb / .mdb）のパスを指定

#### 検査区分ごとのデフォルト値設定
各検査区分の統計パラメータをカスタマイズできます：

| 検査区分 | デフォルト値 | カスタマイズ可能 |
|----------|-------------|------------------|
| **強化検査** | AQL 0.10%, LTPD 0.50%, α 3.0%, β 5.0%, c値 0 | ✅ |
| **標準検査** | AQL 0.25%, LTPD 1.0%, α 5.0%, β 10.0%, c値 0 | ✅ |
| **緩和検査** | AQL 0.40%, LTPD 1.5%, α 10.0%, β 15.0%, c値 0 | ✅ |

- **設定の保存**: 変更した値は自動的に保存されます
- **デフォルトに戻す**: 各検査区分の設定を初期値にリセット可能
- **スクロール対応**: 設定項目が多い場合はスクロールバーで表示

## 🧮 統計パラメータの説明

| パラメータ | 説明 |
|------------|------|
| **AQL (%)** | 受入品質限界 – 良品とみなす上限不良率 |
| **LTPD (%)** | ロット許容不良率 – 不良ロットを排除したい水準 |
| **α (%)** | 第1種の誤り – 良いロットを不合格とする確率 |
| **β (%)** | 第2種の誤り – 悪いロットを合格とする確率 |
| **c値** | 抜取検査で許容する不良数 |

### 📋 検査水準管理機能

「検査水準管理」ボタンから以下の情報を確認できます：

- **現在の検査区分**: 選択中の検査区分とその統計パラメータ
- **検査水準の運用ルール**: 各検査区分の適用基準と運用方針
- **デフォルト値の設定**: アプリケーション設定画面での変更方法

この機能により、検査水準の運用管理と品質管理の一貫性を確保できます。

## 🔐 セキュリティメモ

- 入力値の検証とファイルアクセス制御をアプリ内で実装しています。
- security.log にアクセス拒否や例外情報を記録するため、利用環境に合わせて保管してください。
- ワンファイル版でも Microsoft Access ODBC ドライバが必要です。未インストールの場合は事前にセットアップしてください。

## 🧩 トラブルシューティング

| 症状 | チェック箇所 / 対処 |
|------|-----------------------|
| アプリが起動しない | ウイルス対策ソフトの隔離、Windows SmartScreen の許可設定を確認 |
| Access 接続エラー | ドライバの有無、指定パス、読み取り権限、ファイル共有状態を確認 |
| 抜取数が表示されない | 入力値（ロットサイズ・AQL / LTPD）と対象期間に該当データがあるか確認 |
| OC カーブが表示されない | 計算実行後であること、必要データがデータベースに存在することを確認 |

## 🏗 開発者向けメモ（任意）

- ソースコードを取得する場合は git clone 後、pip install -r requirements.txt で依存を導入してください。
- pyinstaller app.spec でワンファイル実行形式を生成できます。

### 主要モジュール構成

| モジュール | 機能 |
|------------|------|
| **main.py** | エントリーポイント兼コントローラ |
| **gui.py** | Tkinter ベースのメイン画面 |
| **config_manager.py** | 設定管理（検査区分設定、デフォルト値管理） |
| **settings_dialog.py** | アプリケーション設定ダイアログ |
| **inspection_level_manager.py** | 検査水準管理機能 |
| **ui_manager.py** | カード／テーブル描画とメッセージ表示 |
| **calculation_engine.py** | 統計計算エンジン（SciPy 利用） |
| **database.py** | Access との接続ラッパー |
| **security_manager.py** | セキュリティ管理（暗号化、ログ） |

### 設定ファイル

- **app_config.json**: アプリケーション設定（データベースパス、検査区分設定、デフォルト値）
- **security.log**: セキュリティログ（アクセス記録、エラー情報）

### 統計計算の改善（v2.0）

- **超幾何分布の修正**: 有限母集団補正の正確な計算
- **統計計算の優先**: 最小値強制適用の見直し
- **実用的な抜取数**: 品番ごとに最適化された抜取数の算出
- **データベース実績活用**: 実績不良率に基づくAQL/LTPD自動調整

---
**AI SQC Sampler** – 統計的品質管理で検査効率を高めるデスクトップツール



## 📝 抜取数の計算ロジックについて

### 統計計算の優先
抜取数は、データベース実績に基づくAQL/LTPD調整後の統計計算結果を優先します。

### 最小値・最大値の制御
統計計算結果が極端に小さい場合（ロットサイズの5%未満）のみ、検査区分ごとの最小値を適用します：
- **強化検査**: ロットの60%（最小値）
- **標準検査**: ロットの40%（最小値）
- **緩和検査**: ロットの25%（最小値）

### 実用的な上限制限
統計計算結果が実用的でない場合の上限制限：
- **強化検査**: ロットの50%（上限）
- **標準検査**: ロットの30%（上限）
- **緩和検査**: ロットの20%（上限）

### データベース実績の活用
品番ごとの実績不良率に基づいてAQL/LTPDを自動調整し、統計的に最適な抜取数を算出します。これにより、品番ごとに異なる適切な抜取数が計算されます。

## 🔄 アプリケーションの動作仕様

### 起動時の動作
- **検査区分**: 毎回「標準検査」で起動
- **設定値の固定**: 各検査区分の設定値は常にデフォルト値に固定
- **設定の保持**: ユーザーが設定画面で変更した値は次回起動時も保持

### 検査区分の運用
- **自動設定**: 検査区分を選択すると、対応する統計パラメータが自動設定
- **カスタマイズ**: アプリケーション設定画面で各検査区分のデフォルト値を変更可能
- **一貫性**: 設定変更後も各検査区分の設定値は安定して保持される
